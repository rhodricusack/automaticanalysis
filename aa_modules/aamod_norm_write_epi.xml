<?xml version="1.0" encoding="utf-8"?>
<aap>
    <tasklist>
        <currenttask domain='session' mfile_alias='aamod_norm_write' desc='SPM normalisation write (stream EPI)' modality='MRI'>
            
            <!-- this is identical to norm_write.xml, just with a name that better describes what it does -->
			
            <qsub>
                <timeBase>0.5</timeBase>
                <memoryBase>0.1</memoryBase>
            </qsub>
            
            <permanenceofoutput>2</permanenceofoutput>
            
            <vox desc='voxel size of normalised images'>2 2 2</vox>
			
            <!-- <bb desc='bounding box of normalised images (-X X -Y Y -Z Z)'>-78 78 -112 76 -70 85</bb> -->			
            <!-- change default bb to match MNI template -->
			
            <!--<bb>-90 90 -126 90 -72 108</bb>-->
            <bb>-Inf Inf -Inf Inf -Inf Inf</bb>

            <interp>4</interp>
            
            <!-- aamod_norm_write.m looks for normalisation_seg_sn first -->
            <!-- and uses old nomalization. Otherwise it looks for -->
            <!-- forward_deformation_field and uses new normalization -->
            <!-- if neither of these can be found, the code exits -->
			
            <!-- normalisation_seg_sn is generated by the norm_noss module family -->
            <!-- forward_deformation_field is generated by the segment8 family -->
			
            <!-- stream 'structural' is only used to checkreg the results -->
            <!-- however, the code will crash if it can't load it -->
			 
            <!-- NB: the "ismodified=0 on epi here is very confusing. -->
            <!-- epi is indeed modified, but new file(s) are created -->
            <!-- by reslicing. The *original* epi is unmodified, and -->
            <!-- by telling aa that it can use ln rather than cp -->
            <!-- when setting up the working directory to save space -->
			
			
            <inputstreams>
                <stream isessential='0'>forward_deformation_field</stream>
                <stream isessential='0'>normalisation_seg_sn</stream>                  
                <stream diagnostic="1">structural</stream> 
                <stream ismodified='0'>epi</stream>
            </inputstreams>
            
            <outputstreams>
                <stream>epi</stream>                
            </outputstreams>
            
        </currenttask>
    </tasklist>
</aap>
